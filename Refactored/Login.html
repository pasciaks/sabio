<!DOCTYPE html>
<html lang="en">

<head>

    <title>Pasciak-C93 Starter Vanilla JS</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Sabio Coding Bootcamp" />
    <meta itemprop="image" content="https://sabio.la/Sabio.png">

    <link rel="shortcut icon" href="https://sabio.la/Sabio.png">
    <link rel="icon" type="image/png" href="https://sabio.la/Sabio.png" />

    <script src="https://pw.sabio.la/api/js/site"></script>

    <link href="https://pw.sabio.la/dist/all-site.css" rel="stylesheet" />

    <link href="./css/toastr.css" rel="stylesheet" />

    <script src="./js/tests.js"></script>

    <script src="./js/utilities.js"></script>

    <script src="https://unpkg.com/axios@0.19.2/dist/axios.min.js"></script>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script src="./js/toastr.min.js"></script>

    <!-- Import my javascript services code -->

    <script src="./js/services/authService.js"></script>
    <script src="./js/services/blogsService.js"></script>
    <script src="./js/services/emailsService.js"></script>
    <script src="./js/services/eventsService.js"></script>
    <script src="./js/services/filesService.js"></script>
    <script src="./js/services/friendsService.js"></script>
    <script src="./js/services/jobsService.js"></script>
    <script src="./js/services/teamsService.js"></script>
    <script src="./js/services/techcompaniesService.js"></script>

    <!-- ðŸ’¡ All your CSS in here -->

    <link href="./css/main.css" rel="stylesheet" />

    <link href="./css/sidebar.css" rel="stylesheet" />

</head>

<body>

    <nav class="do-not-remove navbar navbar-expand-md navbar-dark bg-dark sabio d-none"></nav>

    <div w3-include-html="./includes/nav.html"></div>

    <div class="container loginFormContainer">
        <form id="loginForm" class="was-validated">
            <p class="loginWelcome">Welcome</p>
            <p>Sign In To Continue</p>
            <div class="form-group">
                <label>Login Email: </label>
                <input required class="form-control" autocomplete="email" type="text" name="loginEmail" id="loginEmail" placeholder="yourname@somewhere.com" value="sabio@sabio.la">
            </div>
            <div class="form-group">
                <label>Password: </label>
                <input required class="form-control" autocomplete="current-password" type="password" name="loginPassword" id="loginPassword" placeholder="password" value="Sabiopassword1!">
            </div>

            <div class="form-group">
                <label>Tenant Id: <input type="text" class="form-control" name="loginTenant" id="loginTenant" value="bootcamp1"></label>
            </div>

            <button type="button" class="btn btn-success btn-lg btn-block m-1" onclick="onClickLoginUser();">Login</button>

            <p>Need to sign up?</p>

            <button type="button" onclick="window.location='./Register.html';" class="btn btn-secondary btn-lg btn-block m-1">Register Now</button>
        </form>

    </div>

    <script>
        var services = {
            authService: authService,
            blogsService: blogsService,
            emailsService: emailsService,
            eventsService: eventsService,
            filesService: filesService,
            friendsService: friendsService,
            jobsService: jobsService,
            teamsService: teamsService,
            techcompaniesService: techcompaniesService
        }

        $(document).ready(function() {

            //executeTests();

            startUp();

        });

        function startUp() {
            includeHTML(); // Note - this will run on every page, better served with views/routing/local storage perhaps
        }


        function readLoginFormData() {

            // successful payload example
            var loginFormData = {
                "email": "sabio@sabio.la",
                "password": "Sabiopassword1!",
                "tenantId": "bootcamp1"
            }

            var loginEmail = $('#loginEmail').val() || "";
            var loginPassword = $('#loginPassword').val() || "";
            var loginTenant = $('#loginTenant').val() || "";

            loginFormData.email = loginEmail;
            loginFormData.password = loginPassword;
            loginFormData.tenantId = loginTenant;

            console.log(loginFormData);

            return loginFormData;
        }

        function loginUser() {

            var userPayload = readLoginFormData();

            services.authService.userLogin(userPayload)
                .then(onLoginUserSuccess)
                .catch(onLoginUserError)

        }

        function onLoginUserSuccess(response) {
            toastr.success(response, "User Login Success."); // map response current user
            //window.location = "./Home.html";

            services.authService.getCurrentUser()
                .then(function(data) {
                    console.log(data);
                })
                .catch(function(data) {
                    console.log(data);
                })



        }

        function onLoginUserError(error) {
            toastr.warning(error.Message, "Error During User Login.");
        }

        function onClickLoginUser() {
            loginUser();
        }
    </script>

    <!-- Do Not Edit or Remove this footer element -->
    <footer class="do-not-remove container-fluid footer mx-auto  fb-targert sabio d-none">
        <p class="text-center">Â© Sabio.la 2019</p>
    </footer>

    <!-- ðŸ›‘ Do Not Write Any Code Below here -->
</body>

</html>