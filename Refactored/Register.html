<!DOCTYPE html>
<html lang="en">

<head>

    <title>Pasciak-C93 Starter Vanilla JS</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Sabio Coding Bootcamp" />
    <meta itemprop="image" content="https://sabio.la/Sabio.png">

    <link rel="shortcut icon" href="https://sabio.la/Sabio.png">
    <link rel="icon" type="image/png" href="https://sabio.la/Sabio.png" />

    <script src="https://pw.sabio.la/api/js/site"></script>

    <link href="https://pw.sabio.la/dist/all-site.css" rel="stylesheet" />

    <link href="./css/toastr.css" rel="stylesheet" />

    <script src="./js/tests.js"></script>

    <script src="./js/utilities.js"></script>

    <script src="https://unpkg.com/axios@0.19.2/dist/axios.min.js"></script>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script src="./js/toastr.min.js"></script>

    <!-- Import my javascript services code -->

    <script src="./js/services/authService.js"></script>
    <script src="./js/services/blogsService.js"></script>
    <script src="./js/services/emailsService.js"></script>
    <script src="./js/services/eventsService.js"></script>
    <script src="./js/services/filesService.js"></script>
    <script src="./js/services/friendsService.js"></script>
    <script src="./js/services/jobsService.js"></script>
    <script src="./js/services/teamsService.js"></script>
    <script src="./js/services/techcompaniesService.js"></script>

    <!-- ðŸ’¡ All your CSS in here -->

    <link href="./css/main.css" rel="stylesheet" />


</head>

<body>

    <nav class="do-not-remove navbar navbar-expand-md navbar-dark bg-dark sabio d-none"></nav>

    <div w3-include-html="./includes/nav.html"></div>

    <div class="container registerFormContainer">

        <form id="registerForm" class="was-validated">

            <p class="registerWelcome">Please Register Your Information Below</p>

            <div class="form-group row">
                <label class="col-sm-3 col-form-label">First Name: </label>
                <div class="col-sm-9">
                    <input required type="text" class="form-control" name="registerFirst" id="registerFirst" placeholder="Firstname" value="Sheldon">
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-3 col-form-label">Last Name: </label>
                <div class="col-sm-9">
                    <input required type="text" class="form-control" name="registerLast" id="registerLast" placeholder="Lastname" value="Pasciak">
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-3 col-form-label" onclick="setRandomEmail();"><u>Email:</u> </label>
                <div class="col-sm-9">
                    <input required type="text" class="form-control" autocomplete="email" name="registerEmail" id="registerEmail" placeholder="email" value="someone1@pasciak.com">
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-3 col-form-label">Password: </label>
                <div class="col-sm-9">
                    <input required type="password" class="form-control" autocomplete="current-password" name="registerPassword" id="registerPassword" placeholder="password" value="Sabiopassword1!">
                </div>
            </div>

            <div class="form-group row">
                <label class="col-sm-3 col-form-label">Confirm Password: </label>
                <div class="col-sm-9">
                    <input required type="password" class="form-control" autocomplete="current-password" name="registerConfirmPassword" id="registerConfirmPassword" placeholder="password" value="Sabiopassword1!">
                </div>
            </div>

            <div class="form-group row">
                <input type="submit" class="form-control btn-success" name="registerButton" id="registerButton" onclick="onClickRegisterUser();return true;" value="Register">
            </div>

            <div class="form-group">
                <label>Avatar Url: <input type="text" class="form-control" name="registerAvatar" id="registerAvatar" value="http://lostwords.org/images/penguin.png"></label>
                <label>Tenant Id: <input type="text" class="form-control" name="registerTenant" id="registerTenant" value="bootcamp1"></label>
            </div>

        </form>

    </div>

    <script>
        var services = {
            authService: authService,
            blogsService: blogsService,
            emailsService: emailsService,
            eventsService: eventsService,
            filesService: filesService,
            friendsService: friendsService,
            jobsService: jobsService,
            teamsService: teamsService,
            techcompaniesService: techcompaniesService
        }

        function startUp() {
            includeHTML(); // Note - this will run on every page, better served with views/routing/local storage perhaps
            wireUpEvents();
        }

        function wireUpEvents() {
            $("#registerForm").submit(function(event) {
                event.preventDefault();
            });
        }

        function setRandomEmail() {
            $('#registerEmail').val(Date.now() + "_user@pasciak.com");
        }

        function readRegisterFormData() {

            var regFirstName = $('#registerFirst').val() || "";
            var regLastName = $('#registerLast').val() || "";
            var regEmail = $('#registerEmail').val() || "";
            var regPassword = $('#registerPassword').val() || "";
            var regConfirmPassword = $('#registerConfirmPassword').val() || "";
            var regAvatar = $('#registerAvatar').val() || "";
            var regTenant = $('#registerTenant').val() || "";

            var registerFormData = {
                "firstName": regFirstName,
                "lastName": regLastName,
                "email": regEmail,
                "password": regPassword,
                "passwordConfirm": regConfirmPassword,
                "avatarUrl": regAvatar,
                "tenantId": regTenant
            }

            console.log("readRegisterFormData...", registerFormData);

            return registerFormData;
        }

        function registerNewUser() {

            var userPayload = readRegisterFormData();

            services.authService.userRegister(userPayload)
                .then(onRegisterUserSuccess)
                .catch(onRegisterUserError)
        }

        function onRegisterUserSuccess(response) {
            console.log(response);
            console.log(JSON.stringify(response));

            toastr.success(response, "User Registered Successfully."); // map response current user

            setTimeout(function() {
                window.location = "./Login.html";
            }, 1000);
        }

        function onRegisterUserError(error) {

            try {
                var errorMessages = error.response.data.errors || [];
                errorMessages.map((oneErrorMessage) => {
                    console.log("****", oneErrorMessage);
                    toastr.warning(`Error ${oneErrorMessage}`, `Error registering your account, please verify your information.`);
                });
            } catch (e) {
                toastr.warning(`Error`, `Undetermined Error Has Occurred.`);
            }


        }

        function onClickRegisterUser() {
            registerNewUser();
        }
    </script>

    <!-- Do Not Edit or Remove this footer element -->
    <footer class="do-not-remove container-fluid footer mx-auto  fb-targert sabio d-none">
        <p class="text-center">Â© Sabio.la 2019</p>
    </footer>

    <!-- ðŸ›‘ Do Not Write Any Code Below here -->
</body>

</html>