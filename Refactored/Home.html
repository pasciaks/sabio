<!DOCTYPE html>
<html lang="en">

<head>

    <title>HOME-C93 Starter Vanilla JS</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="Sabio Coding Bootcamp" />
    <meta itemprop="image" content="https://sabio.la/Sabio.png">

    <link rel="shortcut icon" href="https://sabio.la/Sabio.png">
    <link rel="icon" type="image/png" href="https://sabio.la/Sabio.png" />

    <script src="https://pw.sabio.la/api/js/site"></script>

    <link href="https://pw.sabio.la/dist/all-site.css" rel="stylesheet" />

    <link href="./css/toastr.css" rel="stylesheet" />

    <script src="./js/tests.js"></script>

    <script src="./js/utilities.js"></script>

    <script src="https://unpkg.com/axios@0.19.2/dist/axios.min.js"></script>

    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script src="./js/toastr.min.js"></script>

    <!-- Import my javascript services code -->

    <script src="./js/services/authService.js"></script>
    <script src="./js/services/blogsService.js"></script>
    <script src="./js/services/emailsService.js"></script>
    <script src="./js/services/eventsService.js"></script>
    <script src="./js/services/filesService.js"></script>
    <script src="./js/services/friendsService.js"></script>
    <script src="./js/services/jobsService.js"></script>
    <script src="./js/services/teamsService.js"></script>
    <script src="./js/services/techcompaniesService.js"></script>

    <!-- ðŸ’¡ All your CSS in here -->

    <link href="./css/main.css" rel="stylesheet" />




</head>

<body>

    <nav class="do-not-remove navbar navbar-expand-md navbar-dark bg-dark sabio d-none"></nav>

    <div w3-include-html="./includes/nav.html"></div>

    <div class="container-fluid">
        <div id="loggedIn" style="display:none;">
            <div id="loggedInUserInfo"></div>
            <button onclick="onLogoutClicked();" type="button" class="btn btn-danger">Logout</button>
        </div>
        <div id="loggedOut" style="display:none;">
            <div id="loggedOutUserInfo"></div>
            <button onclick="onLoginClicked();" type="button" class="btn btn-success">Login</button>
        </div>
    </div>

    <script>
        var services = {
            authService: authService,
            blogsService: blogsService,
            emailsService: emailsService,
            eventsService: eventsService,
            filesService: filesService,
            friendsService: friendsService,
            jobsService: jobsService,
            teamsService: teamsService,
            techcompaniesService: techcompaniesService
        }

        function startUp() {
            includeHTML(); // Note - this will run on every page, better served with views/routing/local storage perhaps
            getCurrentUser();
        }

        function onLoginClicked() {
            window.location = "./Login.html";
        }

        function onLogoutClicked() {
            services.authService.userLogout()
                .then(onUserLogoutSuccess)
                .catch(onUserLogoutError)
        }

        function onUserLogoutSuccess(response) {
            // todo -- update user status view            
            //toastr.success(response, "User Logout Success"); // map response current user

            window.location = "./Login.html";
        }

        function onUserLogoutError(error) {
            // todo -- update user status view
            //toastr.error(error, "User Logout Error - Perhaps the user is already logged out."); // map response current user

            window.location = "./Login.html";
        }

        function getCurrentUser() {

            services.authService.getCurrentUser()
                .then(onGetCurrentUserSuccess)
                .catch(onGetCurrentUserError)
        }



        function onGetCurrentUserSuccess(response) {
            console.log(response);

            $('#loggedIn').show();
            $('#loggedOut').hide();

            var loggedInUserId = response.data.item.id;
            getUser(loggedInUserId);
        }

        function onGetCurrentUserError(error) {
            console.log(error);

            $('#loggedIn').hide();
            $('#loggedOut').show();

            var userStatus = `Please log in.`;
            $('#loggedOutUserInfo').html(userStatus);

        }

        function getUser(userId) {
            services.authService.getUser(userId)
                .then(onGetUserSuccess)
                .catch(onGetUserError)
        }

        function onGetUserSuccess(response) {
            console.log("onGetUserSuccess", response);
            var userStatus = `<img style="max-height:100px;max-width:200px;" src="${response.data.item.avatarUrl}"><p>${response.data.item.firstName} ${response.data.item.lastName} </p><p>${response.data.item.email} </p>`
            $('#loggedInUserInfo').html(userStatus);
        }

        function onGetUserError(error) {
            console.log("onGetUserError", error);
            var userStatus = `Please log in.`
            $('#loggedOutUserInfo').html(userStatus);
        }
    </script>

    <!-- Do Not Edit or Remove this footer element -->
    <footer class="do-not-remove container-fluid footer mx-auto  fb-targert sabio d-none">
        <p class="text-center">Â© Sabio.la 2019</p>
    </footer>

    <!-- ðŸ›‘ Do Not Write Any Code Below here -->
</body>

</html>